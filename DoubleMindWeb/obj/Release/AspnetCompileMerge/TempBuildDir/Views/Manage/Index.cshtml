@using DoubleMindWeb.Models;
@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.Owin;
@using System.Web;
@model DoubleMindWeb.Models.IndexViewModel
@{
    ViewBag.Title = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
</head>
<div class="profile">
    <h2>@ViewBag.Title.</h2>
    @{
        ApplicationDbContext db = new ApplicationDbContext();
        ApplicationUserManager userManager = HttpContext.Current.GetOwinContext()
                                               .GetUserManager<ApplicationUserManager>();
        ApplicationUser user = userManager.FindByName(User.Identity.Name);
    }
    <hr />
    <dl class="dl-horizontal" style="margin-top: 30pt; margin-bottom: 30pt">

        <dt>Player: </dt>
        <dd>@user.UserName</dd>
        <dt>Level: </dt>
        <dd>@user.UserLevel</dd>
        <dt>Points: </dt>
        <dd>@user.UserPoints</dd>
    </dl></div>

    <div class="profile">
        <h2>Admin`s information</h2>
        <hr />
        <dl class="dl-horizontal" style="margin-top: 50pt; margin-bottom: 50pt">
            @if (user.Roles.Count > 1)
            {

                <dt>Visited site: </dt>
                <dd>@ApplicationInstance.Application["Totaluser"]</dd>
                <dt>Game Downloads: </dt>
                <dd>@db.Users.Count()</dd>
                <dt>Number of Comments: </dt>
                <dd>@db.Comments.Count()</dd>
                <dt>Average mark: </dt>
                <dd>@db.Comments.Average(p => p.CommentStars)</dd>
            }

        </dl></div>

        <div class="profile">
            <p class="text-success">@ViewBag.StatusMessage</p>
            <div>
                <h4>Changing account parameters</h4>
                <hr />
                <dl class="dl-horizontal">
                    <dt>Password:</dt>
                    <dd>
                        [
                        @if (Model.HasPassword)
                        {
                            @Html.ActionLink("Change password", "ChangePassword")
                        }
                        else
                        {
                            @Html.ActionLink("Create", "SetPassword")
                        }
                        ]
                    </dd>
                    <dt>Outer login names:</dt>
                    <dd>
                        @Model.Logins.Count [
                        @Html.ActionLink("Manage", "ManageLogins") ]
                    </dd>
                    <dd>
                        @*
                        Номера телефонов можно использовать в качестве второго проверочного фактора для системы двухфакторной проверки подлинности.

                         В <a href="https://go.microsoft.com/fwlink/?LinkId=403804">этой статье</a>
                            можно узнать, как для этого приложения ASP.NET настроить двухфакторную проверку подлинности с использованием SMS.

                         Настроив двухфакторную проверку подлинности, раскомментируйте следующий блок
                        *@
                        @*
                        <dt>Номер телефона:</dt>
                        <dd>
                            @(Model.PhoneNumber ?? "None")
                            @if (Model.PhoneNumber != null)
                            {
                                <br />
                                <text>[&nbsp;&nbsp;@Html.ActionLink("Change", "AddPhoneNumber")&nbsp;&nbsp;]</text>
                                using (Html.BeginForm("RemovePhoneNumber", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <text>[<input type="submit" value="Удалить" class="btn-link" />]</text>
                                }
                            }
                            else
                            {
                                <text>[&nbsp;&nbsp;@Html.ActionLink("Add", "AddPhoneNumber")
                            }
                        </dd>
                        *@

                        @*@if (Model.TwoFactor)
                        {
                            using (Html.BeginForm("DisableTwoFactorAuthentication", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                            {
                                @Html.AntiForgeryToken()
                                <text>Включено
                                <input type="submit" value="Отключить" class="btn btn-link" />
                                </text>
                            }
                        }
                        else
                        {
                            using (Html.BeginForm("EnableTwoFactorAuthentication", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                            {
                                @Html.AntiForgeryToken()
                                <text>Отключено
                                <input type="submit" value="Включить" class="btn btn-link" />
                                </text>
                            }
                        }*@
                    </dd>
                </dl>
            </div>
        </div>
